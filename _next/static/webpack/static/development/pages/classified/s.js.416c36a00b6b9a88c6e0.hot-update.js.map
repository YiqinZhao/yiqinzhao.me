{"version":3,"file":"static/webpack/static/development/pages/classified/s.js.416c36a00b6b9a88c6e0.hot-update.js","sources":["webpack:///./pages/classified/s.tsx"],"sourcesContent":["import React from \"react\"\nimport Head from \"next/head\"\nimport { style, media } from \"typestyle\"\nimport fetch from \"isomorphic-unfetch\"\n\nimport HStack from \"../../components/HStack\"\n\nimport Header from \"../../components/Header\"\nimport Footer from \"../../components/Footer\"\n\nimport ResponsiveContainer from \"../../components/ResponsiveContainer\"\nimport Spacer from \"../../components/Spacer\"\nimport MarkdownView from \"../../components/MarkdownView\"\n\nimport { EYRIE_URL } from \"../../utils\"\n\ndeclare var __NEXT_DATA__: any\ndeclare var requestIdleCallback: any\ndeclare var Fingerprint2: any\n\nconst s = {\n    titleContainer: style({\n        width: \"100%\",\n        marginBottom: \"30px\"\n    }),\n    title: style({\n        margin: \"0 0 10px 0\",\n        fontSize: \"3rem\"\n    }),\n    meta: style({\n        width: \"100%\",\n        borderBottom: \"1px dashed rgba(0, 0, 0, 0.4)\"\n    }),\n    category: style({\n        fontWeight: \"bold\",\n        lineHeight: \"2rem\"\n    }),\n    date: style({\n        marginLeft: \"10px\",\n        lineHeight: \"2rem\"\n    }),\n    passwordField: style({\n        width: \"100%\",\n        height: \"3rem\",\n        border: \"0.5px solid rgba(0, 0, 0, 0.2)\",\n        fontSize: \"1.1rem\",\n        padding: \"0 0.7rem\",\n        boxSizing: \"border-box\",\n        transition: \"box-shadow linear 300ms\",\n        textAlign: \"center\",\n        \"$nest\": {\n            \"&:focus\": {\n                outlineWidth: \"0\",\n                boxShadow: \"0 5px 10px rgba(0, 0, 0, 0.1)\"\n            }\n        }\n    }),\n    button: style({\n        width: \"100%\",\n        maxWidth: \"400px\",\n        fontSize: \"0.9rem\",\n        border: \"none\",\n        boxShadow: \"0 5px 12px rgb(134, 186, 251)\",\n        padding: \"0.6rem 0.8rem\",\n        backgroundColor: \"#74b0fb\",\n        color: \"#FFFFFF\",\n        fontWeight: \"bold\",\n        transition: \"box-shadow linear 100ms\",\n        borderRadius: \"3px\",\n        cursor: \"pointer\",\n        marginTop: \"2rem\",\n        \"$nest\": {\n            \"&:focus\": {\n                outlineWidth: \"0\"\n            },\n            \"&:active\": {\n                boxShadow: \"0 2px 6px rgb(134, 186, 251)\",\n                backgroundColor: \"#86bafb\",\n                color: \"#FEFEFE\",\n                \"-webkit-tap-highlight-color\": \"transparent\"\n            }\n        }\n    }),\n    bodyLoading: style({\n        fontFamily: \"Impact, sans-serif\",\n        fontSize: \"1.8rem\",\n        color: \"#5696E7\"\n    }),\n    watermark: style({\n        position: \"fixed\",\n        left: \"-20vw\",\n        top: \"0\",\n        width: \"100vw\",\n        height: \"113px\",\n        fontSize: \"1.25rem\",\n        color: \"rgba(0, 0, 0, 0.2)\",\n        textAlign: \"center\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        fontWeight: 700,\n        zIndex: 10\n    }, media({ minWidth: 320, maxWidth: 480 }, {\n        left: \"0\",\n        height: \"62px\",\n    })),\n    ert: style({\n        marginLeft: \"10px\",\n        lineHeight: \"2rem\",\n        opacity: 0.4\n    })\n}\n\ninterface IClassifiedArticleItemProps {\n    date: string\n}\n\ninterface IClassifiedArticleItemState {\n    article: any\n    authored: boolean\n    loading: boolean\n}\n\nclass ClassifiedArticleItem extends React.Component<IClassifiedArticleItemProps, IClassifiedArticleItemState> {\n    static async getInitialProps({ req }) {\n        if (req) {\n            const dayjs = require(\"dayjs\")\n            const date = dayjs().format(\"MMM D, YYYY\")\n\n            return { date }\n        }\n        return __NEXT_DATA__.props.pageProps\n    }\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            article: null,\n            authored: false,\n            loading: false\n        }\n    }\n\n    onProceedButtonClick = async () => {\n        // Debounce\n        if (this.state.loading) return\n\n        let url = new URL(window.location.href)\n        let id = url.searchParams.get(\"id\")\n\n        let password = (document.getElementById(\"password\") as HTMLInputElement).value\n\n        if (!!password && !!id) {\n            let payload\n\n            if (requestIdleCallback) {\n                payload = await (() => (new Promise(resolve => requestIdleCallback(function () {\n                    Fingerprint2.get((components) => {\n                        resolve(components)\n                    })\n                }))))()\n            } else {\n                payload = await (() => (new Promise(resolve => requestIdleCallback(function () {\n                    Fingerprint2.get((components) => {\n                        resolve(components)\n                    })\n                }))))()\n            }\n\n            console.log(JSON.stringify(payload))\n\n            return;\n\n            let data = {\n                id,\n                password,\n                payload: {\n                    date: (new Date()).toString(),\n                    userAgent: window.navigator.userAgent\n                }\n            }\n\n            // Start network job\n            this.setState({ loading: true })\n\n            fetch(`${EYRIE_URL}/api/classified`, {\n                method: \"POST\", // *GET, POST, PUT, DELETE, etc.\n                mode: \"cors\", // no-cors, *cors, same-origin\n                cache: \"no-cache\", // *default, no-cache, reload, force-cache, only-if-cached\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                // credentials: \"include\",\n                redirect: \"follow\", // manual, *follow, error\n                referrer: \"no-referrer\", // no-referrer, *client\n                body: JSON.stringify(data) // body data type must match \"Content-Type\" header\n            }).then(response => {\n                if (response.ok) {\n                    return response.json()\n                } else {\n                    return Promise.reject(response)\n                }\n            }).then(data => {\n                this.setState({ article: data, authored: true, loading: false })\n\n                setTimeout(() => {\n                    window.scrollTo(0, 0)\n                }, 10)\n\n                setTimeout(() => {\n                    (document.getElementById(\"embedded-music\") as HTMLIFrameElement).src = data.meta.music\n                }, 500)\n            }).catch(err => {\n                alert(\"Authorization failed!\")\n                this.setState({ authored: false, loading: false })\n            })\n        }\n    }\n\n    render() {\n        let { authored, article, loading } = this.state\n\n        let date = this.props.date\n        let title = \"ðŸ”’ Require Authentication\"\n\n        let meta = !authored\n            ? (<Spacer />)\n            : (<HStack className={s.meta}>\n                <div className={s.category}>\n                    {article.meta.category}\n                </div>\n                <div className={s.date}>\n                    {article.meta.date}\n                </div>\n                <div className={s.ert}>\n                    {Math.ceil(article.body.length / 400)}min\n                </div>\n            </HStack>)\n\n        let body = !authored\n            ? (<div>\n                <input id=\"password\" className={s.passwordField} type=\"password\" />\n                <p>You are accessing a classified article, password authentication is required. The password should already been provided from Yiqin to you, please use it.</p>\n                <p><b>Note:</b> Please <b>DO NOT</b> <u>redistribute</u> or <u>share any information</u> from classified articles, including <i>copy-paste</i>, <i>screenshot</i>, <i>print</i>, etc. To protect the classified information, your usage of <a href=\"yiqinzhao.me\">yiqinzhao.me</a> on classified articles <b>will be tracked</b>. By clicking the <i>Proceed</i> button, you have acknowledged and agree the above regulations.</p>\n                <HStack align=\"flex-end\">\n                    <button className={s.button} onClick={this.onProceedButtonClick}>Proceed</button>\n                </HStack>\n            </div>)\n            : <MarkdownView content={article.body} />\n\n        body = loading\n            ? (<div className={s.bodyLoading}>Loading...</div>)\n            : body\n\n        let musicSection = article && article.meta.music ? (\n            <ResponsiveContainer>\n                <Spacer />\n                <iframe id=\"embedded-music\" frameBorder=\"0\" height=\"86\" width=\"330\" src=\"data:text/html,<div style='font-size: 40px; text-align: center; width: 100%; line-height: 66px; font-family: Impact, sans-serif; color: rgba(0, 0, 0, 0.1)'>Loading Music</div>\"></iframe>\n                <Spacer />\n            </ResponsiveContainer>\n        ) : <></>\n\n        let watermark = authored\n            ? <div className={s.watermark}>Accessor: {article.accessor}</div>\n            : <></>\n\n        return (\n            <div className=\"classified-container main-container\">\n                <Head>\n                    <title>ðŸ”’ {authored ? article.meta.title : \"Classified\"} | YiqinZhao</title>\n                    <script src=\"//cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/2.1.0/fingerprint2.min.js\"></script>\n                </Head>\n\n                <Header />\n\n                {watermark}\n\n                <ResponsiveContainer>\n                    <Spacer />\n                    <div className={s.titleContainer}>\n                        <h1 className={s.title}>\n                            {authored ? article.meta.title : title}\n                        </h1>\n                        {meta}\n                    </div>\n                    <Spacer />\n                </ResponsiveContainer>\n\n                {musicSection}\n\n                <ResponsiveContainer>\n                    <Spacer />\n                    {body}\n                    <Spacer />\n                </ResponsiveContainer>\n\n                <Footer date={date} />\n            </div>\n        )\n    }\n}\n\nexport default ClassifiedArticleItem\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AADA;AATA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAJA;AAdA;AA0BA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAcA;AAAA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAtFA;AACA;AAsGA;;;;;;;;;;;;;;;;AACA;AACA;AAAA;;;;;AACA;AACA;AAEA;AAAA;AAAA;AACA;;AACA;AACA;;;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AAEA;AACA;AARA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAaA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AACA;AAdA;AAaA;AAbA;AAAA;AACA;AADA;AAAA;AAAA;AAmBA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AACA;AApBA;AAmBA;AACA;AApBA;AA0BA;AA1BA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AARA;AACA;AACA;AACA;AAHA;AAFA;AAOA;AACA;;;AA6EA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;AAhLA;AACA;AAkLA;;;;A","sourceRoot":""}